<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNAP Connection Manager - User Guide</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-top: 2em;
        }
        h1 { font-size: 2em; }
        h2 { font-size: 1.75em; }
        h3 { font-size: 1.5em; }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        code {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            background-color: #eee;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        pre {
            background-color: #eee;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .toc {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 2em;
        }
        .toc h2 {
            margin-top: 0;
            border-bottom: none;
        }
        .toc ul {
            padding-left: 20px;
        }
        .toc > ol {
             padding-left: 20px;
        }
        li {
            margin-bottom: 0.5em;
        }
    </style>
</head>
<body>

    <h1>SNAP Connection Manager - User & Technical Guide</h1>

    <div class="toc">
        <h2>Table of Contents</h2>
        <ol>
            <li><a href="#introduction">Introduction</a></li>
            <li><a href="#core-features">Core Features</a>
                <ul>
                    <li><a href="#features-management">Server & Folder Management</a></li>
                    <li><a href="#features-connection">Connection & Automation</a></li>
                    <li><a href="#features-data">Data Management & Logging</a></li>
                </ul>
            </li>
            <li><a href="#encryption">The "Super Safe" Encryption System</a>
                <ul>
                    <li><a href="#encryption-how">How It Works</a></li>
                    <li><a href="#encryption-storage">Data Storage Location</a></li>
                    <li><a href="#encryption-change-pass">Changing Your Passphrase</a></li>
                </ul>
            </li>
            <li><a href="#appearance">Appearance & Customization</a>
                <ul>
                    <li><a href="#appearance-global">Global Settings</a></li>
                </ul>
            </li>
            <li><a href="#getting-started">Getting Started</a></li>
            <li><a href="#installation">Installation Instructions</a></li>
            <li><a href="#troubleshooting">Troubleshooting & Dependencies</a></li>
        </ol>
    </div>

    <h2 id="introduction">1. Introduction</h2>
    <p>Welcome to the <strong>SNAP Connection Manager</strong>, a powerful and secure GTK3-based desktop application for managing and launching SSH and SFTP connections. Designed with security and usability in mind, this tool allows you to organize numerous server configurations into folders, automate complex login sequences, and tunnel traffic with port forwarding.</p>
    <p>The cornerstone of this application is its robust, GnuPG-based encryption system, which ensures that all your sensitive connection details (passwords, key file paths, etc.) are never stored unencrypted on your disk.</p>

    <h2 id="core-features">2. Core Features</h2>

    <h3 id="features-management">2.1 Server & Folder Management</h3>
    <ul>
        <li><strong>Hierarchical Organization</strong>: Organize your servers into user-defined folders for clarity. Servers not assigned to a specific folder reside in the default <code>Session</code> root.</li>
        <li><strong>Full CRUD Operations</strong>: Easily <strong>Add</strong>, <strong>Edit</strong>, and <strong>Delete</strong> server configurations and folders through intuitive menus and right-click context menus.</li>
        <li><strong>Inline Renaming</strong>: Quickly rename any folder or server directly in the tree view. Simply select the item, wait a brief moment, and click it again (slow double-click) to enter edit mode.</li>
        <li><strong>Drag-and-Drop</strong>: Reorder servers within a folder or move servers between folders simply by dragging and dropping them in the main list.</li>
        <li><strong>Copy & Paste</strong>:
            <ul>
                <li><strong>Via Menu</strong>: Use the right-click menu to Copy a server and Paste it into any folder.</li>
                <li><strong>Via Shortcuts</strong>: Use <code>Ctrl+C</code> to copy a selected server and <code>Ctrl+V</code> to paste it.</li>
            </ul>
        </li>
        <li><strong>Keyboard Shortcuts</strong>:
            <ul>
                <li><code>Delete</code>: Deletes the selected server or folder (with confirmation).</li>
                <li><code>Ctrl+C</code> / <code>Ctrl+V</code>: Copy and Paste servers.</li>
            </ul>
        </li>
        <li><strong>Natural Sorting</strong>: All servers and folders are sorted using a natural alphanumeric algorithm (e.g., <code>server10</code> appears after <code>server9</code>).</li>
    </ul>

    <h3 id="features-connection">2.2 Connection & Automation</h3>
    <ul>
        <li><strong>Dual Protocol Support</strong>: Launch connections using either <strong>SSH</strong> (for interactive shell access) or <strong>SFTP</strong> (for file transfers).</li>
        <li><strong>Embedded VTE Terminal</strong>: Connections launch in a native, high-performance terminal window with advanced features:
            <ul>
                <li><strong>Smart Copy/Paste</strong>: Use <code>Ctrl+C</code> to copy text (if text is highlighted) or send an interrupt signal (if nothing is highlighted). Use <code>Ctrl+V</code> to paste.</li>
                <li><strong>Context Menu</strong>: Right-click anywhere in the terminal to access Copy and Paste options.</li>
                <li><strong>Auto-Resize Sync</strong>: The terminal automatically synchronizes its dimensions with the remote host, preventing broken text wrapping when resizing windows.</li>
            </ul>
        </li>
        <li><strong>Authentication</strong>: Supports both Password-based (automated via <code>expect</code>) and Key File-based (via <code>-i</code> flag) authentication.</li>
        <li><strong>Automated Login Sequences</strong>: Define "Expect/Send" steps to automate complex login procedures, sudo prompts, or initial commands. You can also hide specific "Send" steps (like passwords) from the UI.</li>
        <li><strong>Advanced Port Forwarding</strong>: Configure Local (<code>-L</code>), Remote (<code>-R</code>), and Dynamic (<code>-D</code>) forwarding rules visually.</li>
    </ul>

    <h3 id="features-data">2.3 Data Management & Logging</h3>
    <ul>
        <li><strong>Encrypted Import/Export</strong>: Export your data to <code>JSON</code> (plaintext) or <code>GPG</code> (encrypted). The application intelligently switches the file extension based on your selection.</li>
        <li><strong>GUI Log Pane</strong>: A log view at the bottom of the main window provides real-time feedback.</li>
        <li><strong>Per-Server Session Logging</strong>: Enable logging for individual servers to save terminal output to a local file.</li>
    </ul>

    <h2 id="encryption">3. The "Super Safe" Encryption System</h2>
    <p>Your security is paramount. The application's design ensures that your sensitive server credentials are never left vulnerable on your hard drive.</p>

    <h3 id="encryption-how">3.1 How It Works</h3>
    <ol>
        <li><strong>Master Passphrase Creation</strong>: On the very first launch, you are required to set a <strong>Master Passphrase</strong>.</li>
        <li><strong>State-of-the-Art Hashing</strong>: Your passphrase is hashed using <strong>PBKDF2-HMAC-SHA256</strong> with a unique salt and 600,000 iterations.</li>
        <li><strong>Symmetric GPG Encryption</strong>: Server data is stored in <code>ssh_servers.json.gpg</code>, encrypted using the <strong>AES256</strong> cipher via GnuPG.</li>
        <li><strong>On-Demand Decryption</strong>: Data is only decrypted in memory while the application is running.</li>
    </ol>

    <h3 id="encryption-storage">3.2 Data Storage Location</h3>
    <ul>
        <li><strong>Path</strong>: <code>~/.local/share/snap_connection_manager/</code></li>
        <li><strong>Files</strong>: <code>snap_cm_settings.json</code> (Settings) and <code>ssh_servers.json.gpg</code> (Encrypted Data).</li>
    </ul>

    <h3 id="encryption-change-pass">3.3 Changing Your Passphrase</h3>
    <p>You can securely rotate your key via <code>File -> Change Passphrase...</code>. This re-encrypts your data file atomically with the new credentials.</p>

    <h2 id="appearance">4. Appearance & Customization</h2>
    
    <h3 id="appearance-server">4.1 Per-Server Customization</h3>
    <p>The <strong>Appearance tab</strong> in the Server Editor allows you to customize individual connections:</p>
    <ul>
        <li><strong>Font & Colors</strong>: Select system fonts, custom foreground/background colors, and palettes (Tango, Solarized, etc.).</li>
        <li><strong>Scrollback</strong>: Configure history size (default: 10,000 lines).</li>
    </ul>

    <h3 id="appearance-global">4.2 Global Settings</h3>
    <p>Accessed via <code>File -> Global Settings...</code>, this dialog allows you to define the <strong>default configuration</strong> for the application.</p>
    <ul>
        <li><strong>Default Appearance</strong>: Set the font, colors, and palette that will be applied to all <em>newly created</em> servers.</li>
        <li><strong>Default Log Folder</strong>: Specify the default directory where session logs will be saved.</li>
        <li><strong>Reset to Defaults</strong>: When editing a server, the "Reset to Defaults" button will restore that server's settings to match these Global Settings.</li>
    </ul>

    <h2 id="getting-started">5. Getting Started</h2>
    <ol>
        <li><strong>First Launch</strong>: Set your Master Passphrase to initialize the secure storage.</li>
        <li><strong>Add Servers</strong>: Right-click the "Session" folder and select "Add Server".</li>
        <li><strong>Connect</strong>: Double-click a server to launch the terminal.</li>
    </ol>

    <h2 id="installation">6. Installation Instructions</h2>
    <p>You can install SNAP Connection Manager directly from its official APT repository.</p>
    
    <h3>6.1 Quick Install Script</h3>
    <pre><code>curl -sL https://raw.githubusercontent.com/larreblarsson/SNAP-Connection-Manager/main/install.sh | bash</code></pre>
    
    <h3>6.2 Manual Installation</h3>
    <pre><code># Add the GPG key
    curl -sL https://larreblarsson.github.io/SNAP-Connection-Manager/public.key | sudo gpg --dearmor -o /usr/share/keyrings/SNAP-Connection-Manager-keyring.gpg
    
    # Add the repository
    echo "deb [signed-by=/usr/share/keyrings/SNAP-Connection-Manager-keyring.gpg] https://larreblarsson.github.io/SNAP-Connection-Manager stable main" | sudo tee /etc/apt/sources.list.d/SNAP-Connection-Manager.list
    
    # Update and install
    sudo apt update
    sudo apt install snap-connection-manager
    </code></pre>

    <h2 id="troubleshooting">7. Troubleshooting & Dependencies</h2>
    <ul>
        <li><strong>"Incorrect master passphrase."</strong>: Data is unrecoverable without the passphrase. Delete <code>~/.local/share/snap_connection_manager/</code> to reset.</li>
        <li><strong>Dependencies</strong>: The app requires <code>python3-gi</code>, <code>gir1.2-gtk-3.0</code>, <code>gir1.2-vte-2.91</code>, <code>expect</code>, and <code>gnupg</code>.</li>
    </ul>

</body>
</html>
